# ğŸš€ Plateforme DevOps

Une plateforme DevOps complÃ¨te basÃ©e sur Docker Compose intÃ©grant Jenkins, Gitea, Traefik, Prometheus et Grafana.

## ğŸ“‹ Table des matiÃ¨res

- [Vue d'ensemble](#vue-densemble)
- [Architecture](#architecture)
- [Services inclus](#services-inclus)
- [PrÃ©requis](#prÃ©requis)
- [Installation et dÃ©marrage](#installation-et-dÃ©marrage)
- [Configuration](#configuration)
- [AccÃ¨s aux services](#accÃ¨s-aux-services)
- [Monitoring](#monitoring)
- [SÃ©curitÃ©](#sÃ©curitÃ©)
- [Maintenance](#maintenance)
- [DÃ©pannage](#dÃ©pannage)

## ğŸ¯ Vue d'ensemble

Cette plateforme DevOps offre un environnement complet pour le dÃ©veloppement, l'intÃ©gration continue et le monitoring d'applications. Elle combine les outils essentiels de la chaÃ®ne DevOps moderne dans une architecture containerisÃ©e.

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Traefik      â”‚    â”‚    Jenkins      â”‚    â”‚     Gitea       â”‚
â”‚   (Reverse      â”‚    â”‚   (CI/CD)       â”‚    â”‚   (Git Server)  â”‚
â”‚    Proxy)       â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Prometheus    â”‚    â”‚    Grafana      â”‚
                    â”‚   (Monitoring)  â”‚    â”‚  (Visualization)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ Services inclus

### 1. **Traefik** - Reverse Proxy et Load Balancer
- **Version**: v3.4
- **FonctionnalitÃ©s** :
  - Gestion automatique des certificats SSL/TLS avec Let's Encrypt
  - Routage intelligent basÃ© sur les labels Docker
  - Dashboard d'administration
  - Redirection HTTP vers HTTPS automatique

### 2. **Jenkins** - IntÃ©gration Continue
- **Image**: jenkins-with-docker:latest (custom)
- **FonctionnalitÃ©s** :
  - Pipeline CI/CD
  - IntÃ©gration Docker native
  - AccÃ¨s au socket Docker pour les builds
  - Interface web sÃ©curisÃ©e

### 3. **Gitea** - Serveur Git
- **Version**: 1.21.11
- **FonctionnalitÃ©s** :
  - Gestion de dÃ©pÃ´ts Git
  - Interface web moderne
  - Gestion des utilisateurs et permissions
  - IntÃ©gration avec Jenkins

### 4. **Prometheus** - Monitoring
- **FonctionnalitÃ©s** :
  - Collecte de mÃ©triques
  - Monitoring des conteneurs Docker
  - MÃ©triques Traefik
  - Stockage des donnÃ©es de monitoring

### 5. **Grafana** - Visualisation
- **FonctionnalitÃ©s** :
  - Dashboards de monitoring
  - IntÃ©gration Prometheus
  - Visualisation des mÃ©triques
  - Alertes configurables

### 6. **Registry** - Registre Docker privÃ©
- **Image**: registry:2
- **FonctionnalitÃ©s** :
  - HÃ©bergement dâ€™images Docker privÃ©es pour vos projets
  - AccÃ¨s sÃ©curisÃ© via HTTPS grÃ¢ce Ã  Traefik et Let's Encrypt
  - Stockage persistant des images dans `./data/registry`
  - Accessible Ã  lâ€™adresse : https://registry.wk-archi-o23b-4-5-g7.fr:5000

## ğŸ“‹ PrÃ©requis

- **Docker** : Version 20.10 ou supÃ©rieure
- **Docker Compose** : Version 2.0 ou supÃ©rieure
- **SystÃ¨me** : Linux, macOS ou Windows avec WSL2
- **Ressources** :
  - RAM : Minimum 4GB (recommandÃ© 8GB)
  - CPU : 2 cÅ“urs minimum
  - Stockage : 20GB d'espace libre

## ğŸš€ Installation et dÃ©marrage

### 1. Cloner le projet
```bash
git clone <votre-repo>
cd devops-platform
```

### 2. Construire l'image Jenkins personnalisÃ©e
```bash
cd jenkins
docker build -t jenkins-with-docker:latest .
cd ..
```

### 3. DÃ©marrer la plateforme
```bash
docker-compose up -d
```

### 4. VÃ©rifier le statut
```bash
docker-compose ps
```

## âš™ï¸ Configuration

### Variables d'environnement

CrÃ©er un fichier `.env` Ã  la racine du projet :

```env
# Configuration Traefik
TRAEFIK_EMAIL=kayeromy@gmail.com
DOMAIN=wk-archi-o23b-4-5-g7.fr

# Configuration Grafana
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# Configuration Jenkins
JENKINS_PORT=8081
```

### Configuration des domaines

Modifier les labels Traefik dans `docker-compose.yml` pour vos domaines :

```yaml
labels:
  - "traefik.http.routers.jenkins.rule=Host(`jenkins.votre-domaine.com`)"
  - "traefik.http.routers.gitea.rule=Host(`gitea.votre-domaine.com`)"
  - "traefik.http.routers.grafana.rule=Host(`grafana.votre-domaine.com`)"
```

## ğŸŒ AccÃ¨s aux services

Une fois dÃ©marrÃ©, accÃ©dez aux services via :

| Service | URL | Port | Description |
|---------|-----|------|-------------|
| **Traefik Dashboard** | https://traefik.wk-archi-o23b-4-5-g7.fr | 80/443 | Interface d'administration Traefik |
| **Jenkins** | https://jenkins.wk-archi-o23b-4-5-g7.fr | 8081 | Interface CI/CD |
| **Gitea** | https://gitea.wk-archi-o23b-4-5-g7.fr | 3000 | Serveur Git |
| **Grafana** | https://grafana.wk-archi-o23b-4-5-g7.fr | 3000 | Dashboards de monitoring |
| **Prometheus** | https://prometheus.wk-archi-o23b-4-5-g7.fr | 9090 | MÃ©triques systÃ¨me |
| **Registry** | https://registry.wk-archi-o23b-4-5-g7.fr | 5000 | Registre privÃ© dâ€™images Docker |

### Identifiants par dÃ©faut

- **Grafana** : admin/admin
- **Jenkins** : Suivre les instructions d'installation initiale
- **Gitea** : CrÃ©er un compte administrateur lors de la premiÃ¨re connexion

## ğŸ“Š Monitoring

### MÃ©triques collectÃ©es

- **Docker** : Utilisation CPU, mÃ©moire, rÃ©seau
- **Traefik** : RequÃªtes HTTP, latence, erreurs
- **Jenkins** : Jobs, builds, temps d'exÃ©cution
- **Gitea** : ActivitÃ© des dÃ©pÃ´ts, utilisateurs

### Dashboards Grafana

Les dashboards sont automatiquement provisionnÃ©s depuis `grafana/provisioning/dashboards/`.

### Alertes

Configurer les alertes dans `monitoring/alerts/rules.yml` :

```yaml
groups:
  - name: docker
    rules:
      - alert: HighCPUUsage
        expr: container_cpu_usage_seconds_total > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage detected"
```

## ğŸ”’ SÃ©curitÃ©

### Certificats SSL/TLS
- Certificats automatiques via Let's Encrypt
- Renouvellement automatique
- Redirection HTTP vers HTTPS

### AccÃ¨s sÃ©curisÃ©
- Traefik comme reverse proxy sÃ©curisÃ©
- Isolation rÃ©seau avec Docker networks
- Volumes persistants pour les donnÃ©es sensibles

### Bonnes pratiques
- Changer les mots de passe par dÃ©faut
- Configurer les pare-feu
- Surveiller les logs d'accÃ¨s
- Mettre Ã  jour rÃ©guliÃ¨rement les images

## ğŸ› ï¸ Maintenance

### Sauvegarde
```bash
# Sauvegarder les volumes
docker run --rm -v devops-platform_jenkins_home:/data -v $(pwd):/backup alpine tar czf /backup/jenkins-backup.tar.gz -C /data .
docker run --rm -v devops-platform_gitea_data:/data -v $(pwd):/backup alpine tar czf /backup/gitea-backup.tar.gz -C /data .
docker run --rm -v devops-platform_grafana_data:/data -v $(pwd):/backup alpine tar czf /backup/grafana-backup.tar.gz -C /data .
```

### Mise Ã  jour
```bash
# Mettre Ã  jour les images
docker-compose pull
docker-compose up -d
```

### Logs
```bash
# Voir les logs de tous les services
docker-compose logs -f

# Logs d'un service spÃ©cifique
docker-compose logs -f jenkins
```

## ğŸ”§ DÃ©pannage

### ProblÃ¨mes courants

#### 1. Services ne dÃ©marrent pas
```bash
# VÃ©rifier les logs
docker-compose logs

# VÃ©rifier l'espace disque
df -h

# VÃ©rifier les ports utilisÃ©s
netstat -tulpn | grep :80
```

#### 2. Certificats SSL non gÃ©nÃ©rÃ©s
- VÃ©rifier que le domaine pointe vers le serveur
- VÃ©rifier les logs Traefik : `docker-compose logs traefik`
- VÃ©rifier la configuration Let's Encrypt

#### 3. Jenkins ne peut pas accÃ©der Ã  Docker
```bash
# VÃ©rifier les permissions du socket Docker
ls -la /var/run/docker.sock

# RedÃ©marrer Jenkins
docker-compose restart jenkins
```

#### 4. Gitea ne dÃ©marre pas
```bash
# VÃ©rifier les permissions des volumes
sudo chown -R 1000:1000 gitea/

# RedÃ©marrer Gitea
docker-compose restart gitea
```

### Commandes utiles

```bash
# RedÃ©marrer tous les services
docker-compose restart

# Reconstruire et redÃ©marrer
docker-compose up -d --build

# Nettoyer les conteneurs arrÃªtÃ©s
docker-compose down

# Ouvrir une rÃ©seau manuelement sur docker si on met external rue
docker network create tiptop-net


# Supprimer tous les volumes (âš ï¸ ATTENTION)
docker-compose down -v
```

## ğŸ“ Structure du projet

```
devops-platform/
â”œâ”€â”€ docker-compose.yml          # Configuration principale
â”œâ”€â”€ jenkins/
â”‚   â””â”€â”€ Dockerfile             # Image Jenkins personnalisÃ©e
â”œâ”€â”€ gitea/
â”‚   â””â”€â”€ app.ini               # Configuration Gitea
â”œâ”€â”€ grafana/
â”‚   â””â”€â”€ provisioning/         # Dashboards et datasources
â”œâ”€â”€ monitoring/
â”‚   â”œâ”€â”€ prometheus.yml        # Configuration Prometheus
â”‚   â””â”€â”€ alerts/
â”‚       â””â”€â”€ rules.yml         # RÃ¨gles d'alertes
â””â”€â”€ traefik/
    â””â”€â”€ letsencrypt/          # Certificats SSL
```

## ğŸ¤ Contribution

1. Fork le projet
2. CrÃ©er une branche feature (`git checkout -b feature/AmazingFeature`)
3. Commit les changements (`git commit -m 'Add AmazingFeature'`)
4. Push vers la branche (`git push origin feature/AmazingFeature`)
5. Ouvrir une Pull Request

## ğŸ“„ Licence

Ce projet est sous licence MIT. Voir le fichier `LICENSE` pour plus de dÃ©tails.

## ğŸ“ Support

Pour toute question ou problÃ¨me :
- Ouvrir une issue sur le repository
- Consulter la documentation officielle des outils utilisÃ©s
- VÃ©rifier les logs des services

---

**Note** : Cette plateforme est conÃ§ue pour un environnement de dÃ©veloppement/test. Pour la production, renforcez la sÃ©curitÃ© et configurez des sauvegardes automatiques.